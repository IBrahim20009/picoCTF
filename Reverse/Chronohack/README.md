# Token Generation Challenge â€” picoCTF Write-Up

## ğŸ” Overview

This challenge revolves around predicting a token generated by a remote service. The server creates a 20-character token using Python's `random` module, seeded with the **current time in milliseconds**. Because of this weak seeding method, the token can be bruteâ€‘forced by recreating the random number generator state.

This write-up explains how the vulnerability works and how the exploit script (`solve.py`) successfully retrieves the challenge flag.

---

## ğŸ“‚ Challenge Source Code Summary

### **token_generator.py**

The challenge service (simplified):

```python
def get_random(length):
    alphabet = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
    random.seed(int(time.time() * 1000))  # seeding with current time
    s = ""
    for i in range(length):
        s += random.choice(alphabet)
    return s
```

The token is generated based on:

* A predictable timestamp seed
* A fully known alphabet
* A deterministic PRNG (`random`)

The program then gives the user **50 attempts** to guess the token.

This system is insecure because timestamps only vary by milliseconds, making the seed space tiny.

---

## ğŸ§  Exploitation Strategy

Your exploit script (`solve.py`) uses the following approach:

1. Connect to the server.
2. Record the exact time (in ms) when the server sends the welcome message.
3. Estimate the seed (`int(time.time() * 1000)`).
4. Brute-force tokens generated from seeds in a window:

   * From **Ts âˆ’ 50 ms** to **Ts + 1000 ms**
5. Reconnect after every 50 attempts (server limit).
6. Stop when the server replies with a success message.

Because the PRNG is predictable and the seed range is small, the correct token is quickly found.

---

## ğŸ›  Exploit Script Behavior

The script:

* Computes oneâ€‘way network delay using a dummy guess
* Adjusts timing for accurate seed prediction
* Regenerates tokens using:

```python
random.seed(seed)
token = ''.join(random.choice(alphabet) for _ in range(token_length))
```

* Sends each generated token to the server
* Detects success when the server prints:

```
Congratulations!
```

---

## ğŸ Flag

`flag.txt` contains:

```
abcdefg
```

This is the flag printed once the correct token is guessed.

---

## ğŸ“¦ Recommended Repository Layout

```
picoCTF-token-challenge/
â”‚
â”œâ”€â”€ solve.py                # exploit script
â”œâ”€â”€ token_generator.py      # challenge source code
â”œâ”€â”€ flag.txt                # challenge flag
â””â”€â”€ README.md               # documentation
```

---

## âœ… Lessons Learned

* Never seed security tokens with timestamps
* Pythonâ€™s `random` module is **not secure** for cryptographic purposes
* Deterministic PRNGs are vulnerable to seed guessing
* Always use `secrets` or `os.urandom()` for sensitive token generation

---


